/* --- Base Variables and Theme Setup --- */
:root {
  /* Font */
  --font-primary: "Manrope", -apple-system, BlinkMacSystemFont, "Segoe UI",
    Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
    sans-serif;
  --font-code: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
    "Liberation Mono", "Courier New", monospace;

  /* Timing & Easing */
  --timing-quick: 0.15s;
  --timing-normal: 0.3s;
  --timing-slow: 0.5s;
  --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --ease-in-out-quad: cubic-bezier(0.455, 0.03, 0.515, 0.955);
  --ease-out-cubic: cubic-bezier(0.215, 0.61, 0.355, 1);
  --ease-elastic-subtle: cubic-bezier(0.64, 0.57, 0.67, 1.53);

  /* Radius */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --radius-full: 9999px;

  /* Shadows (Subtler, more layered) */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.03);
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.04), 0 1px 1px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.05), 0 2px 3px rgba(0, 0, 0, 0.03);
  --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.06), 0 4px 8px rgba(0, 0, 0, 0.04);
  --shadow-xl: 0 20px 30px rgba(0, 0, 0, 0.07), 0 8px 15px rgba(0, 0, 0, 0.05);
  --shadow-focus-ring: 0 0 0 3px rgba(var(--primary-rgb), 0.25);

  /* --- Refined Color Palettes --- */

  /* Light Theme */
  --bg-light: #f8f9fa; /* Lighter, slightly cooler grey */
  --surface-light: #ffffff;
  --surface-alt-light: #f1f3f5; /* Slightly more distinct alt surface */
  --border-light: #dee2e6; /* Softer border */
  --text-primary-light: #212529; /* Dark grey, not pure black */
  --text-secondary-light: #6c757d; /* Standard grey */
  --primary-light: #0d6efd; /* Standard Bootstrap Blue */
  --primary-hover-light: #0b5ed7; /* Darker blue */
  --primary-text-light: #ffffff;
  --accent-light: #e7f5ff; /* Very light blue */
  --thumb-light: #ffffff;
  --track-light: #e9ecef; /* Match border */
  --icon-light: var(--primary-light);
  --code-bg-light: #f1f3f5; /* Match surface-alt */

  /* Dark Theme */
  --bg-dark: #18191a; /* Very dark grey, not pure black */
  --surface-dark: #212529; /* Slightly lighter surface */
  --surface-alt-dark: #343a40; /* Clearer distinction for alt */
  --border-dark: #495057; /* More visible border */
  --text-primary-dark: #f8f9fa; /* Off-white */
  --text-secondary-dark: #adb5bd; /* Lighter grey */
  --primary-dark: #3b82f6; /* Brighter blue for contrast */
  --primary-hover-dark: #60a5fa; /* Lighter blue for hover */
  --primary-text-dark: #ffffff;
  --accent-dark: #27374d; /* Dark blue/grey */
  --thumb-dark: #495057; /* Match border */
  --track-dark: var(--primary-dark);
  --icon-dark: #f8f9fa; /* Match primary text */
  --code-bg-dark: #343a40; /* Match surface-alt */
}

/* Apply theme variables */
[data-theme="light"] {
  --bg: var(--bg-light);
  --surface: var(--surface-light);
  --surface-alt: var(--surface-alt-light);
  --border: var(--border-light);
  --text-primary: var(--text-primary-light);
  --text-secondary: var(--text-secondary-light);
  --primary: var(--primary-light);
  --primary-hover: var(--primary-hover-light);
  --primary-text: var(--primary-text-light);
  --accent: var(--accent-light);
  --thumb-bg: var(--thumb-light);
  --track-bg: var(--track-light);
  --thumb-icon-color: var(--icon-light);
  --code-bg: var(--code-bg-light);
  --primary-rgb: 13, 110, 253; /* For focus ring */
  --surface-rgb: 255, 255, 255;
  --surface-hover-rgb: 241, 243, 245;
  --text-secondary-rgb: 108, 117, 125;
}

[data-theme="dark"] {
  --bg: var(--bg-dark);
  --surface: var(--surface-dark);
  --surface-alt: var(--surface-alt-dark);
  --border: var(--border-dark);
  --text-primary: var(--text-primary-dark);
  --text-secondary: var(--text-secondary-dark);
  --primary: var(--primary-dark);
  --primary-hover: var(--primary-hover-dark);
  --primary-text: var(--primary-text-dark);
  --accent: var(--accent-dark);
  --thumb-bg: var(--thumb-dark);
  --track-bg: var(--track-dark);
  --thumb-icon-color: var(--icon-dark);
  --code-bg: var(--code-bg-dark);
  --primary-rgb: 59, 130, 246; /* For focus ring */
  --surface-rgb: 33, 37, 41;
  --surface-hover-rgb: 52, 58, 64;
  --text-secondary-rgb: 173, 181, 189;
}

/* --- Reset and Base Styles --- */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html {
  font-size: 100%; /* 16px base */
}

body {
  font-family: var(--font-primary);
  font-size: 1rem;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--bg);
  transition: background-color var(--timing-normal) var(--ease-in-out-quad),
    color var(--timing-normal) var(--ease-in-out-quad);
  height: 100vh;
  width: 100vw;
  overflow: hidden;
}

button,
input,
textarea {
  font-family: inherit;
  font-size: inherit;
  color: inherit;
  border: none;
  background: none;
  outline: none;
}

button {
  cursor: pointer;
  -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

/* --- Main Chat Container --- */
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  position: relative;
}

/* --- Floating Header --- */
.floating-header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1.5rem; /* Slightly less vertical padding */
  z-index: 10;
  pointer-events: none;
}

.app-title {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  font-size: 1rem; /* Slightly smaller */
  font-weight: 600;
  color: var(--text-secondary);
  background-color: rgba(var(--surface-rgb), 0.7); /* Less opaque */
  backdrop-filter: blur(16px); /* More blur */
  -webkit-backdrop-filter: blur(16px);
  padding: 0.5rem 1rem; /* More padding */
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-md);
  pointer-events: auto;
  transition: background-color var(--timing-normal) var(--ease-in-out-quad),
    color var(--timing-normal) var(--ease-in-out-quad),
    box-shadow var(--timing-normal) var(--ease-in-out-quad);
}
.app-title i {
  color: var(--primary);
  font-size: 1.1em; /* Make icon slightly larger */
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  pointer-events: auto;
}

/* --- Base Control Button (Clear Button) --- */
.control-button {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-full);
  background-color: rgba(var(--surface-rgb), 0.7);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  box-shadow: var(--shadow-md);
  transition: background-color var(--timing-quick) var(--ease-out-quad),
              color var(--timing-quick) var(--ease-out-quad),
              transform var(--timing-quick) var(--ease-elastic-subtle),
              box-shadow var(--timing-quick) var(--ease-out-quad);
}

.control-button i {
  transition: transform var(--timing-normal) var(--ease-elastic-subtle);
}

.control-button:hover {
  background-color: rgba(var(--surface-hover-rgb), 0.85);
  color: var(--text-primary);
  transform: scale(1.1);
  box-shadow: var(--shadow-lg);
}

#clear-chat:hover i {
    transform: rotate(-15deg) scale(1.05);
}

.control-button:active {
  transform: scale(0.95);
  transition-duration: 0.05s;
  box-shadow: var(--shadow-sm);
}

/* --- Theme Switch Styles --- */
.theme-switch {
  width: 52px; /* Slightly narrower */
  height: 28px;
  border-radius: var(--radius-full);
  padding: 3px;
  box-sizing: content-box;
  background-color: rgba(var(--surface-rgb), 0.7);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  box-shadow: var(--shadow-md);
  position: relative;
  cursor: pointer;
  transition: background-color var(--timing-normal) var(--ease-in-out-quad),
              box-shadow var(--timing-quick) var(--ease-out-quad);
}

.theme-switch-track {
  width: 100%;
  height: 100%;
  border-radius: var(--radius-full);
  background-color: var(--track-bg);
  position: relative;
  transition: background-color var(--timing-normal) var(--ease-in-out-quad);
}

.theme-switch-thumb {
  width: 22px; /* Smaller thumb */
  height: 22px;
  border-radius: 50%;
  background-color: var(--thumb-bg);
  box-shadow: var(--shadow-sm); /* Softer shadow on thumb */
  position: absolute;
  top: 3px;
  left: 3px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform var(--timing-normal) var(--ease-out-cubic), /* Smoother ease */
              background-color var(--timing-normal) var(--ease-in-out-quad);
}

.theme-switch-thumb i {
  font-size: 0.75rem;
  color: var(--thumb-icon-color);
  transition: color var(--timing-normal) var(--ease-in-out-quad);
}

[data-theme="dark"] .theme-switch-thumb {
  /* Move thumb: 52 track - 22 thumb - 3 right padding = 27px */
  transform: translateX(27px);
}

[data-theme="dark"] .theme-switch-thumb i::before { content: "\f186"; }
[data-theme="light"] .theme-switch-thumb i::before { content: "\f185"; }

.theme-switch:hover { box-shadow: var(--shadow-lg); }
.theme-switch:active .theme-switch-thumb { transform: scale(0.9); }
[data-theme="dark"] .theme-switch:active .theme-switch-thumb {
  transform: translateX(27px) scale(0.9);
}

/* --- Message Stream --- */
.message-stream-wrapper {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 6.5rem 1rem 1rem; /* More top padding */
  position: relative;
}

.message-stream {
  max-width: 760px; /* Slightly wider */
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 1.5rem; /* More space between messages */
}

/* --- Message Styling --- */
.message {
  display: flex;
  max-width: 80%; /* Slightly narrower max-width */
  opacity: 1;
  transform: none; /* GSAP handles entry */
}

.user-message { align-self: flex-end; margin-left: auto; }
.assistant-message, .system-message { align-self: flex-start; }

.message-content {
  padding: 0.8rem 1.2rem; /* More horizontal padding */
  border-radius: var(--radius-xl); /* More rounded */
  box-shadow: var(--shadow-md);
  word-wrap: break-word;
  position: relative;
  line-height: 1.55; /* Slightly improve readability */
  transition: background-color var(--timing-normal) var(--ease-in-out-quad),
              color var(--timing-normal) var(--ease-in-out-quad),
              box-shadow var(--timing-normal) var(--ease-in-out-quad);
}

.user-message .message-content {
  background: var(--primary);
  color: var(--primary-text);
  /* Tail effect - slightly different radius */
  border-radius: var(--radius-xl) var(--radius-md) var(--radius-xl) var(--radius-xl);
}

.assistant-message .message-content {
  background-color: var(--surface);
  color: var(--text-primary);
  /* Tail effect - slightly different radius */
  border-radius: var(--radius-md) var(--radius-xl) var(--radius-xl) var(--radius-xl);
}

/* System messages (errors, etc.) */
.system-message:not(.initial-system-message) .message-content {
  width: auto; /* Don't force full width */
  max-width: 100%;
  background-color: transparent;
  box-shadow: none;
  color: var(--text-secondary);
  font-size: 0.875rem; /* Smaller */
  text-align: center;
  padding: 0.5rem 0;
  margin: 0 auto; /* Center align */
}

/* Initial welcome message */
.initial-system-message .message-content {
  width: 100%;
  max-width: 100%;
  background-color: var(--surface-alt);
  border-radius: var(--radius-lg);
  padding: 1.25rem 1.5rem;
  text-align: left;
  box-shadow: var(--shadow-sm);
  color: var(--text-secondary);
}
.initial-system-message .message-content p {
    color: var(--text-primary); /* Make main text primary */
    font-size: 1rem;
    margin-bottom: 1rem;
}

/* Thinking message */
.thinking-message .message-content {
  background-color: var(--surface);
  padding: 0.8rem 1.2rem;
  border-radius: var(--radius-xl);
  display: inline-flex; /* Don't take full width */
  align-items: center;
  gap: 0.75rem;
  color: var(--text-secondary);
  box-shadow: var(--shadow-md);
}

/* Pulsing orb animation remains the same */
.pulsing-orb { width: 18px; height: 18px; position: relative; }
.pulsing-orb::before, .pulsing-orb::after {
  content: ""; position: absolute; inset: 0; border-radius: 50%;
  background-color: var(--primary); opacity: 0.6;
  animation: pulse-orb 1.8s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
.pulsing-orb::after { animation-delay: -0.9s; }
@keyframes pulse-orb {
  0%, 100% { transform: scale(0.5); opacity: 0; }
  50% { transform: scale(1); opacity: 0.6; }
}

/* Suggestion Pills */
.suggestion-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem; /* More gap */
  margin-top: 1.25rem;
}

.suggestion-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1.1rem; /* More padding */
  border-radius: var(--radius-full);
  font-size: 0.875rem;
  font-weight: 500;
  background-color: var(--surface);
  color: var(--primary);
  border: 1px solid var(--border);
  cursor: pointer;
  box-shadow: var(--shadow-xs);
  transition: all var(--timing-quick) var(--ease-out-quad);
}

.suggestion-pill:hover {
  background-color: var(--accent);
  border-color: rgba(var(--primary-rgb), 0.5);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}
.suggestion-pill:hover i { transform: translateX(3px); }
.suggestion-pill:active { transform: translateY(0); box-shadow: var(--shadow-xs); }

.suggestion-pill i {
  font-size: 0.75rem;
  transition: transform var(--timing-quick) var(--ease-out-quad);
}

/* --- Input Dock --- */
.input-dock {
  flex-shrink: 0;
  padding: 1rem 1.5rem 1.5rem;
  position: relative;
  z-index: 5;
  /* Add a subtle top border */
  border-top: 1px solid var(--border);
  background-color: var(--bg); /* Match body background */
  transition: border-color var(--timing-normal) var(--ease-in-out-quad),
              background-color var(--timing-normal) var(--ease-in-out-quad);
}

.chat-form { max-width: 760px; margin: 0 auto; }

.input-area {
  display: flex;
  align-items: flex-end;
  gap: 0.75rem;
  background-color: var(--surface);
  border-radius: var(--radius-xl); /* More rounded */
  padding: 0.75rem 0.8rem 0.75rem 1.25rem; /* Adjusted padding */
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border); /* Subtle border */
  transition: border-color var(--timing-normal) var(--ease-out-quad),
              box-shadow var(--timing-normal) var(--ease-out-quad),
              background-color var(--timing-normal) var(--ease-in-out-quad);
}

.input-area:focus-within {
  border-color: var(--primary);
  box-shadow: var(--shadow-lg), var(--shadow-focus-ring);
}

#user-input {
  flex: 1;
  background: transparent;
  padding: 0.4rem 0; /* Keep vertical padding */
  outline: none;
  resize: none;
  font-size: 1rem;
  color: var(--text-primary);
  max-height: 120px; /* Allow slightly more height */
  line-height: 1.6;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
#user-input::-webkit-scrollbar { display: none; }

#user-input::placeholder {
  color: var(--text-secondary);
  transition: color var(--timing-normal) var(--ease-out-quad);
}

.send-button {
  width: 42px; /* Slightly smaller */
  height: 42px;
  border-radius: var(--radius-lg); /* Match input area rounding */
  background: var(--primary);
  color: var(--primary-text);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  box-shadow: var(--shadow-sm);
  transition: all var(--timing-quick) var(--ease-out-quad);
}

.send-button:hover {
  background: var(--primary-hover);
  transform: scale(1.05);
  box-shadow: var(--shadow-md);
}

.send-button:active {
  transform: scale(0.98);
  box-shadow: none;
}

.send-button i {
  font-size: 1.1rem;
  transition: transform var(--timing-quick) var(--ease-elastic-subtle);
}
.send-button:hover i { transform: rotate(-10deg) scale(1.05); } /* Less rotation */

/* --- Markdown Content Styling --- */
.message-content p { margin-bottom: 0.8em; }
.message-content p:last-child { margin-bottom: 0; }
.message-content ul, .message-content ol { padding-left: 1.75em; margin-bottom: 0.8em; }
.message-content li { margin-bottom: 0.4em; }

.message-content code {
  font-family: var(--font-code);
  font-size: 0.9em;
  padding: 0.25em 0.5em;
  background-color: var(--code-bg);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  color: var(--text-primary); /* Ensure contrast */
}
.message-content pre {
  font-family: var(--font-code);
  margin: 1.2em 0;
  padding: 1em 1.2em;
  background-color: var(--code-bg);
  border-radius: var(--radius-md);
  border: 1px solid var(--border);
  overflow-x: auto;
  font-size: 0.9rem;
  line-height: 1.5;
  color: var(--text-primary); /* Ensure contrast */
}
.message-content pre code {
  background-color: transparent;
  border: none;
  padding: 0;
  font-size: inherit;
  color: inherit; /* Inherit from pre */
}
.message-content h1, .message-content h2, .message-content h3,
.message-content h4, .message-content h5, .message-content h6 {
  margin-top: 1.5em;
  margin-bottom: 0.75em;
  font-weight: 600;
  line-height: 1.4;
}
.message-content h1 { font-size: 1.5em; }
.message-content h2 { font-size: 1.3em; }
.message-content h3 { font-size: 1.15em; }

/* --- Custom Scrollbar --- */
.message-stream-wrapper::-webkit-scrollbar { width: 8px; }
.message-stream-wrapper::-webkit-scrollbar-track { background: transparent; }
.message-stream-wrapper::-webkit-scrollbar-thumb {
  background-color: rgba(var(--text-secondary-rgb), 0.25);
  border-radius: var(--radius-full);
  border: 2px solid transparent; /* Creates padding around thumb */
  background-clip: content-box;
}
.message-stream-wrapper::-webkit-scrollbar-thumb:hover {
  background-color: rgba(var(--text-secondary-rgb), 0.4);
}

/* --- Responsive Adjustments --- */
@media (max-width: 768px) {
  html { font-size: 94%; } /* Slightly smaller base font */

  .floating-header { padding: 0.75rem 1rem; }
  .app-title { padding: 0.4rem 0.8rem; font-size: 0.95rem; }
  .app-title span { display: none; }
  .control-button { width: 36px; height: 36px; font-size: 0.9rem; }
  .theme-switch { width: 46px; height: 24px; padding: 2px; }
  .theme-switch-thumb { width: 20px; height: 20px; top: 2px; left: 2px; }
  .theme-switch-thumb i { font-size: 0.65rem; }
  [data-theme="dark"] .theme-switch-thumb { transform: translateX(24px); }
  [data-theme="dark"] .theme-switch:active .theme-switch-thumb {
    transform: translateX(24px) scale(0.9);
  }

  .message-stream-wrapper { padding-top: 5.5rem; padding-left: 0.75rem; padding-right: 0.75rem; }
  .message-stream { gap: 1.25rem; }
  .message { max-width: 85%; }
  .message-content { padding: 0.7rem 1rem; border-radius: var(--radius-lg); }
  .user-message .message-content { border-radius: var(--radius-lg) var(--radius-sm) var(--radius-lg) var(--radius-lg); }
  .assistant-message .message-content { border-radius: var(--radius-sm) var(--radius-lg) var(--radius-lg) var(--radius-lg); }

  .input-dock { padding: 0.75rem 1rem 1rem; }
  .input-area { padding: 0.6rem 0.7rem 0.6rem 1rem; border-radius: var(--radius-lg); }
  #user-input { font-size: 1rem; max-height: 100px; }
  .send-button { width: 38px; height: 38px; border-radius: var(--radius-md); }
  .send-button i { font-size: 1rem; }

  .suggestion-pills { gap: 0.5rem; margin-top: 1rem; }
  .suggestion-pill { padding: 0.5rem 0.9rem; font-size: 0.8rem; }
}
